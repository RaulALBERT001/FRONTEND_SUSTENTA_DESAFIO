
# Sustenta Desafio API - Documenta칞칚o dos Endpoints

Esta documenta칞칚o detalha todos os endpoints da API de Sustentabilidade, incluindo autentica칞칚o JWT, gerenciamento de usu치rios e desafios de sustentabilidade.

## Base URL
```
http://localhost:8000
```

## Autentica칞칚o
A API utiliza autentica칞칚o JWT (JSON Web Token). Todos os endpoints, exceto os de autentica칞칚o, requerem um token v치lido no header `Authorization: Bearer <token>`.

---

## 游댏 Endpoints de Autentica칞칚o

### 1. Registro de Usu치rio
**POST** `/api/auth/register`

**Fun칞칚o:** Registra um novo usu치rio no sistema

**Par칙metros:** Nenhum par칙metro de URL

**DTO de Entrada:** RegisterRequest
```json
{
  "username": "string",
  "email": "string",
  "password": "string"
}
```

**Valida칞칫es:**
- Username deve ser 칰nico
- Email deve ser 칰nico e v치lido
- Password obrigat칩rio

**Respostas:**

**Sucesso (201 Created):**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "username": "usuario123",
  "message": "User registered successfully"
}
```

**Erro - Username j치 existe (400 Bad Request):**
```json
{
  "token": null,
  "username": null,
  "message": "Username is already taken!"
}
```

**Erro - Email j치 existe (400 Bad Request):**
```json
{
  "token": null,
  "username": null,
  "message": "Email is already in use!"
}
```

**Erro - Falha no registro (400 Bad Request):**
```json
{
  "token": null,
  "username": null,
  "message": "Registration failed: [detalhes do erro]"
}
```

---

### 2. Login de Usu치rio
**POST** `/api/auth/login`

**Fun칞칚o:** Autentica um usu치rio e retorna um token JWT

**Par칙metros:** Nenhum par칙metro de URL

**DTO de Entrada:** LoginRequest
```json
{
  "username": "string",
  "password": "string"
}
```

**Respostas:**

**Sucesso (200 OK):**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "username": "usuario123",
  "message": "Login successful"
}
```

**Erro - Credenciais inv치lidas (400 Bad Request):**
```json
{
  "token": null,
  "username": null,
  "message": "Invalid username or password"
}
```

**Erro - Falha no login (400 Bad Request):**
```json
{
  "token": null,
  "username": null,
  "message": "Login failed: [detalhes do erro]"
}
```

---

## 游꺔 Endpoints de Desafios de Sustentabilidade

**丘멆잺 Todos os endpoints abaixo requerem autentica칞칚o JWT**

### 3. Listar Todos os Desafios
**GET** `/api/desafios`

**Fun칞칚o:** Retorna uma lista com todos os desafios de sustentabilidade

**Par칙metros:** Nenhum

**Headers Obrigat칩rios:**
```
Authorization: Bearer <jwt_token>
```

**Resposta de Sucesso (200 OK):**
```json
[
  {
    "id": 1,
    "titulo": "Reduzir Consumo de 츼gua",
    "descricao": "Diminuir o consumo de 치gua em 20% durante o m칡s",
    "nivelDificuldade": "MEDIO",
    "categoria": "AGUA",
    "pontuacaoMaxima": 100,
    "tempoEstimado": 30,
    "criadoEm": "2024-01-15T10:30:00",
    "atualizadoEm": "2024-01-15T10:30:00"
  },
  {
    "id": 2,
    "titulo": "Uso de Transporte Sustent치vel",
    "descricao": "Utilizar apenas transporte p칰blico ou bicicleta por uma semana",
    "nivelDificuldade": "FACIL",
    "categoria": "TRANSPORTE",
    "pontuacaoMaxima": 80,
    "tempoEstimado": 7,
    "criadoEm": "2024-01-16T14:20:00",
    "atualizadoEm": "2024-01-16T14:20:00"
  }
]
```

---

### 4. Buscar Desafio por ID
**GET** `/api/desafios/{id}`

**Fun칞칚o:** Retorna um desafio espec칤fico pelo seu ID

**Par칙metros de URL:**
- `id` (Long) - ID 칰nico do desafio

**Headers Obrigat칩rios:**
```
Authorization: Bearer <jwt_token>
```

**Resposta de Sucesso (200 OK):**
```json
{
  "id": 1,
  "titulo": "Reduzir Consumo de 츼gua",
  "descricao": "Diminuir o consumo de 치gua em 20% durante o m칡s",
  "nivelDificuldade": "MEDIO",
  "categoria": "AGUA",
  "pontuacaoMaxima": 100,
  "tempoEstimado": 30,
  "criadoEm": "2024-01-15T10:30:00",
  "atualizadoEm": "2024-01-15T10:30:00"
}
```

**Resposta de Erro - Desafio n칚o encontrado (404 Not Found):**
```json
{
  "status": 404,
  "error": "Resource Not Found",
  "message": "Desafio n칚o encontrado com ID: 999",
  "timestamp": "2024-01-20T15:30:45",
  "path": "uri=/api/desafios/999"
}
```

---

### 5. Criar Novo Desafio
**POST** `/api/desafios`

**Fun칞칚o:** Cria um novo desafio de sustentabilidade

**Headers Obrigat칩rios:**
```
Authorization: Bearer <jwt_token>
Content-Type: application/json
```

**DTO de Entrada:** DesafioRequest
```json
{
  "titulo": "string",
  "descricao": "string",
  "nivelDificuldade": "string",
  "categoria": "string",
  "pontuacaoMaxima": "integer",
  "tempoEstimado": "integer"
}
```

**Valida칞칫es:**
- T칤tulo 칠 obrigat칩rio
- Descri칞칚o 칠 obrigat칩ria
- N칤vel de dificuldade deve ser v치lido (FACIL, MEDIO, DIFICIL)
- Categoria 칠 obrigat칩ria
- Pontua칞칚o m치xima deve ser um n칰mero positivo
- Tempo estimado deve ser um n칰mero positivo

**Resposta de Sucesso (201 Created):**
```json
{
  "id": 3,
  "titulo": "Compostagem Dom칠stica",
  "descricao": "Implementar sistema de compostagem em casa",
  "nivelDificuldade": "MEDIO",
  "categoria": "RESIDUOS",
  "pontuacaoMaxima": 120,
  "tempoEstimado": 14,
  "criadoEm": "2024-01-20T16:45:30",
  "atualizadoEm": "2024-01-20T16:45:30"
}
```

**Resposta de Erro - Valida칞칚o (400 Bad Request):**
```json
{
  "status": 400,
  "error": "Validation Failed",
  "message": "Input validation failed for one or more fields",
  "timestamp": "2024-01-20T16:50:00",
  "path": "uri=/api/desafios",
  "validationErrors": {
    "titulo": "T칤tulo 칠 obrigat칩rio",
    "pontuacaoMaxima": "Pontua칞칚o deve ser maior que zero"
  }
}
```

---

### 6. Atualizar Desafio
**PUT** `/api/desafios/{id}`

**Fun칞칚o:** Atualiza um desafio existente

**Par칙metros de URL:**
- `id` (Long) - ID 칰nico do desafio a ser atualizado

**Headers Obrigat칩rios:**
```
Authorization: Bearer <jwt_token>
Content-Type: application/json
```

**DTO de Entrada:** DesafioRequest
```json
{
  "titulo": "string",
  "descricao": "string",
  "nivelDificuldade": "string",
  "categoria": "string",
  "pontuacaoMaxima": "integer",
  "tempoEstimado": "integer"
}
```

**Resposta de Sucesso (200 OK):**
```json
{
  "id": 1,
  "titulo": "Reduzir Consumo de 츼gua - Atualizado",
  "descricao": "Diminuir o consumo de 치gua em 30% durante o m칡s",
  "nivelDificuldade": "DIFICIL",
  "categoria": "AGUA",
  "pontuacaoMaxima": 150,
  "tempoEstimado": 30,
  "criadoEm": "2024-01-15T10:30:00",
  "atualizadoEm": "2024-01-20T17:15:22"
}
```

**Resposta de Erro - Desafio n칚o encontrado (404 Not Found):**
```json
{
  "status": 404,
  "error": "Resource Not Found",
  "message": "Desafio n칚o encontrado com ID: 999",
  "timestamp": "2024-01-20T17:20:00",
  "path": "uri=/api/desafios/999"
}
```

---

### 7. Deletar Desafio
**DELETE** `/api/desafios/{id}`

**Fun칞칚o:** Remove um desafio do sistema

**Par칙metros de URL:**
- `id` (Long) - ID 칰nico do desafio a ser removido

**Headers Obrigat칩rios:**
```
Authorization: Bearer <jwt_token>
```

**Resposta de Sucesso (204 No Content):**
```
(Corpo vazio - apenas status 204)
```

**Resposta de Erro - Desafio n칚o encontrado (404 Not Found):**
```json
{
  "status": 404,
  "error": "Resource Not Found",
  "message": "Desafio n칚o encontrado com ID: 999",
  "timestamp": "2024-01-20T17:25:00",
  "path": "uri=/api/desafios/999"
}
```

---

## 游 Respostas de Erro de Autentica칞칚o

### Token Inv치lido ou Expirado
**Status:** 401 Unauthorized
```json
{
  "status": 401,
  "error": "Unauthorized",
  "message": "Access denied. Please provide a valid JWT token.",
  "path": "/api/desafios"
}
```

### Token n칚o Fornecido
**Status:** 401 Unauthorized
```json
{
  "status": 401,
  "error": "Unauthorized",
  "message": "Access denied. Please provide a valid JWT token.",
  "path": "/api/desafios"
}
```

---

## 游닇 Estruturas de Dados (DTOs)

### RegisterRequest
```typescript
interface RegisterRequest {
  username: string;    // Nome de usu치rio 칰nico
  email: string;       // Email v치lido e 칰nico
  password: string;    // Senha do usu치rio
}
```

### LoginRequest
```typescript
interface LoginRequest {
  username: string;    // Nome de usu치rio
  password: string;    // Senha do usu치rio
}
```

### AuthResponse
```typescript
interface AuthResponse {
  token: string | null;     // JWT token (null em caso de erro)
  username: string | null;  // Nome de usu치rio (null em caso de erro)
  message: string;          // Mensagem de resposta
}
```

### DesafioRequest
```typescript
interface DesafioRequest {
  titulo: string;           // T칤tulo do desafio
  descricao: string;        // Descri칞칚o detalhada
  nivelDificuldade: string; // FACIL, MEDIO, DIFICIL
  categoria: string;        // Categoria do desafio (ex: AGUA, ENERGIA, TRANSPORTE)
  pontuacaoMaxima: number;  // Pontos m치ximos poss칤veis
  tempoEstimado: number;    // Tempo estimado em dias
}
```

### Desafio (Entidade de Resposta)
```typescript
interface Desafio {
  id: number;              // ID 칰nico do desafio
  titulo: string;          // T칤tulo do desafio
  descricao: string;       // Descri칞칚o detalhada
  nivelDificuldade: string;// FACIL, MEDIO, DIFICIL
  categoria: string;       // Categoria do desafio
  pontuacaoMaxima: number; // Pontos m치ximos poss칤veis
  tempoEstimado: number;   // Tempo estimado em dias
  criadoEm: string;        // Data/hora de cria칞칚o (ISO 8601)
  atualizadoEm: string;    // Data/hora da 칰ltima atualiza칞칚o (ISO 8601)
}
```

---

## 游 Exemplos de Uso

### Fluxo Completo de Autentica칞칚o e Uso

1. **Registrar usu치rio:**
```bash
POST /api/auth/register
{
  "username": "ecouser",
  "email": "eco@example.com",
  "password": "minhasenha123"
}
```

2. **Fazer login (se j치 registrado):**
```bash
POST /api/auth/login
{
  "username": "ecouser",
  "password": "minhasenha123"
}
```

3. **Usar o token retornado nos pr칩ximos requests:**
```bash
GET /api/desafios
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

4. **Criar um novo desafio:**
```bash
POST /api/desafios
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
{
  "titulo": "Economia de Energia",
  "descricao": "Reduzir consumo de energia em 15%",
  "nivelDificuldade": "MEDIO",
  "categoria": "ENERGIA",
  "pontuacaoMaxima": 90,
  "tempoEstimado": 21
}
```

---

## 丘멆잺 Notas Importantes

1. **CORS:** A API est치 configurada para aceitar requisi칞칫es de qualquer origem (`*`)
2. **Autentica칞칚o:** Todos os endpoints de desafios requerem token JWT v치lido
3. **Formato de Datas:** Todas as datas s칚o retornadas no formato ISO 8601
4. **Valida칞칚o:** Campos obrigat칩rios s칚o validados automaticamente
5. **Tratamento de Erros:** A API retorna respostas de erro padronizadas com detalhes espec칤ficos

Esta documenta칞칚o fornece todas as informa칞칫es necess치rias para desenvolver um frontend que consuma esta API de forma completa e eficiente.
